function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, "next"); var callThrow = step.bind(null, "throw"); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

var _jasmineFix = require("jasmine-fix");

var _libRegistry = require("../lib/registry");

var _libRegistry2 = _interopRequireDefault(_libRegistry);

describe("Registry", function () {
  var registry = undefined;

  beforeEach(function () {
    registry = new _libRegistry2["default"]();
  });
  afterEach(function () {
    registry.dispose();
  });

  function validateTiles(actual, expected) {
    expect(actual.length).toBe(expected.length);

    actual.forEach(function (entry, index) {
      expect(entry.title).toBe(expected[index]);
    });
  }
  function validateOldTiles(oldTitles, titles) {
    expect(oldTitles.length).toBe(titles.length);

    titles.forEach(function (title, index) {
      expect(oldTitles[index].title).toBe(title);
      expect(oldTitles[index].duration === "1ms" || oldTitles[index].duration === "0ms").toBe(true);
    });
  }

  describe("handling of providers", function () {
    (0, _jasmineFix.it)("registers providers properly and clears them out when they die", function () {
      var provider = registry.create();
      expect(registry.providers.has(provider)).toBe(true);
      provider.dispose();
      expect(registry.providers.has(provider)).toBe(false);
    });
    (0, _jasmineFix.it)("emits update event properly", function () {
      var provider = registry.create();
      var update = jasmine.createSpy("update");
      registry.onDidUpdate(update);
      expect(update).not.toHaveBeenCalled();
      provider.add("Hey");
      provider.remove("Hey");
      provider.clear();
      expect(update).toHaveBeenCalled();
      expect(update.calls.length).toBe(2);
    });
    (0, _jasmineFix.it)("adds and returns sorted titles", _asyncToGenerator(function* () {
      var provider = registry.create();
      provider.add("Hey");
      yield (0, _jasmineFix.wait)(1);
      provider.add("Wow");
      yield (0, _jasmineFix.wait)(1);
      provider.add("Hello");
      validateTiles(registry.getTilesActive(), ["Hello", "Wow", "Hey"]);
    }));
    (0, _jasmineFix.it)("adds removed ones to history", _asyncToGenerator(function* () {
      var provider = registry.create();
      provider.add("Boy");
      yield (0, _jasmineFix.wait)(1);
      provider.add("Hey");
      validateTiles(registry.getTilesActive(), ["Hey", "Boy"]);
      expect(registry.getTilesOld()).toEqual([]);

      provider.remove("Hey");
      validateTiles(registry.getTilesActive(), ["Boy"]);
      validateOldTiles(registry.getTilesOld(), ["Hey"]);
    }));
    (0, _jasmineFix.it)("adds cleared ones to history", function () {
      var provider = registry.create();
      provider.add("Hello");
      provider.add("World");

      validateTiles(registry.getTilesActive(), ["Hello", "World"]);
      expect(registry.getTilesOld()).toEqual([]);

      provider.clear();
      validateTiles(registry.getTilesActive(), []);
      validateOldTiles(registry.getTilesOld(), ["Hello", "World"]);
    });
  });
  describe("getTilesOld", function () {
    (0, _jasmineFix.it)("excludes active ones from history", function () {
      var provider = registry.create();
      provider.add("Yo CJ");
      provider.add("Murica");
      provider.remove("Yo CJ");
      provider.remove("Murica");
      provider.add("Yo CJ");

      validateOldTiles(registry.getTilesOld(), ["Murica"]);
    });
    (0, _jasmineFix.it)("excludes duplicates and only returns the last one", function () {
      var provider = registry.create();

      provider.add("Some");
      provider.add("Things");
      provider.remove("Some");
      provider.remove("Things");
      provider.add("Some");
      provider.remove("Some");

      validateOldTiles(registry.getTilesOld(), ["Things", "Some"]);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FyY2hpZS8uYXRvbS9wYWNrYWdlcy9idXN5LXNpZ25hbC9zcGVjL3JlZ2lzdHJ5LXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OzswQkFFeUIsYUFBYTs7MkJBQ2pCLGlCQUFpQjs7OztBQUd0QyxRQUFRLENBQUMsVUFBVSxFQUFFLFlBQVc7QUFDOUIsTUFBSSxRQUFRLFlBQUEsQ0FBQzs7QUFFYixZQUFVLENBQUMsWUFBVztBQUNwQixZQUFRLEdBQUcsOEJBQWMsQ0FBQztHQUMzQixDQUFDLENBQUM7QUFDSCxXQUFTLENBQUMsWUFBVztBQUNuQixZQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7R0FDcEIsQ0FBQyxDQUFDOztBQUVILFdBQVMsYUFBYSxDQUNwQixNQUE2QixFQUM3QixRQUF1QixFQUN2QjtBQUNBLFVBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQzs7QUFFNUMsVUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFDLEtBQUssRUFBRSxLQUFLLEVBQUs7QUFDL0IsWUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7S0FDM0MsQ0FBQyxDQUFDO0dBQ0o7QUFDRCxXQUFTLGdCQUFnQixDQUN2QixTQUFxRCxFQUNyRCxNQUFxQixFQUNyQjtBQUNBLFVBQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQzs7QUFFN0MsVUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFTLEtBQUssRUFBRSxLQUFLLEVBQUU7QUFDcEMsWUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDM0MsWUFBTSxDQUNKLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLEtBQUssS0FBSyxJQUNqQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxLQUFLLEtBQUssQ0FDdEMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDZCxDQUFDLENBQUM7R0FDSjs7QUFFRCxVQUFRLENBQUMsdUJBQXVCLEVBQUUsWUFBVztBQUMzQyx3QkFBRyxnRUFBZ0UsRUFBRSxZQUFXO0FBQzlFLFVBQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNuQyxZQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDcEQsY0FBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ25CLFlBQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUN0RCxDQUFDLENBQUM7QUFDSCx3QkFBRyw2QkFBNkIsRUFBRSxZQUFXO0FBQzNDLFVBQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNuQyxVQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzNDLGNBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0IsWUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQ3RDLGNBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEIsY0FBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN2QixjQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDakIsWUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7QUFDbEMsWUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3JDLENBQUMsQ0FBQztBQUNILHdCQUFHLGdDQUFnQyxvQkFBRSxhQUFpQjtBQUNwRCxVQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDbkMsY0FBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwQixZQUFNLHNCQUFLLENBQUMsQ0FBQyxDQUFDO0FBQ2QsY0FBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwQixZQUFNLHNCQUFLLENBQUMsQ0FBQyxDQUFDO0FBQ2QsY0FBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN0QixtQkFBYSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztLQUNuRSxFQUFDLENBQUM7QUFDSCx3QkFBRyw4QkFBOEIsb0JBQUUsYUFBaUI7QUFDbEQsVUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ25DLGNBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEIsWUFBTSxzQkFBSyxDQUFDLENBQUMsQ0FBQztBQUNkLGNBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEIsbUJBQWEsQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUN6RCxZQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDOztBQUUzQyxjQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3ZCLG1CQUFhLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUNsRCxzQkFBZ0IsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0tBQ25ELEVBQUMsQ0FBQztBQUNILHdCQUFHLDhCQUE4QixFQUFFLFlBQVc7QUFDNUMsVUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ25DLGNBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDdEIsY0FBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQzs7QUFFdEIsbUJBQWEsQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztBQUM3RCxZQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDOztBQUUzQyxjQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDakIsbUJBQWEsQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDN0Msc0JBQWdCLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7S0FDOUQsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0FBQ0gsVUFBUSxDQUFDLGFBQWEsRUFBRSxZQUFXO0FBQ2pDLHdCQUFHLG1DQUFtQyxFQUFFLFlBQVc7QUFDakQsVUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ25DLGNBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDdEIsY0FBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN2QixjQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3pCLGNBQVEsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDMUIsY0FBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQzs7QUFFdEIsc0JBQWdCLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztLQUN0RCxDQUFDLENBQUM7QUFDSCx3QkFBRyxtREFBbUQsRUFBRSxZQUFXO0FBQ2pFLFVBQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQzs7QUFFbkMsY0FBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNyQixjQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3ZCLGNBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDeEIsY0FBUSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMxQixjQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3JCLGNBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRXhCLHNCQUFnQixDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO0tBQzlELENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiIvaG9tZS9hcmNoaWUvLmF0b20vcGFja2FnZXMvYnVzeS1zaWduYWwvc3BlYy9yZWdpc3RyeS1zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cblxuaW1wb3J0IHsgaXQsIHdhaXQgfSBmcm9tIFwiamFzbWluZS1maXhcIjtcbmltcG9ydCBSZWdpc3RyeSBmcm9tIFwiLi4vbGliL3JlZ2lzdHJ5XCI7XG5pbXBvcnQgdHlwZSB7IFNpZ25hbEludGVybmFsIH0gZnJvbSBcIi4uL2xpYi90eXBlc1wiO1xuXG5kZXNjcmliZShcIlJlZ2lzdHJ5XCIsIGZ1bmN0aW9uKCkge1xuICBsZXQgcmVnaXN0cnk7XG5cbiAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHtcbiAgICByZWdpc3RyeSA9IG5ldyBSZWdpc3RyeSgpO1xuICB9KTtcbiAgYWZ0ZXJFYWNoKGZ1bmN0aW9uKCkge1xuICAgIHJlZ2lzdHJ5LmRpc3Bvc2UoKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gdmFsaWRhdGVUaWxlcyhcbiAgICBhY3R1YWw6IEFycmF5PFNpZ25hbEludGVybmFsPixcbiAgICBleHBlY3RlZDogQXJyYXk8c3RyaW5nPlxuICApIHtcbiAgICBleHBlY3QoYWN0dWFsLmxlbmd0aCkudG9CZShleHBlY3RlZC5sZW5ndGgpO1xuXG4gICAgYWN0dWFsLmZvckVhY2goKGVudHJ5LCBpbmRleCkgPT4ge1xuICAgICAgZXhwZWN0KGVudHJ5LnRpdGxlKS50b0JlKGV4cGVjdGVkW2luZGV4XSk7XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gdmFsaWRhdGVPbGRUaWxlcyhcbiAgICBvbGRUaXRsZXM6IEFycmF5PHsgdGl0bGU6IHN0cmluZywgZHVyYXRpb246IHN0cmluZyB9PixcbiAgICB0aXRsZXM6IEFycmF5PHN0cmluZz5cbiAgKSB7XG4gICAgZXhwZWN0KG9sZFRpdGxlcy5sZW5ndGgpLnRvQmUodGl0bGVzLmxlbmd0aCk7XG5cbiAgICB0aXRsZXMuZm9yRWFjaChmdW5jdGlvbih0aXRsZSwgaW5kZXgpIHtcbiAgICAgIGV4cGVjdChvbGRUaXRsZXNbaW5kZXhdLnRpdGxlKS50b0JlKHRpdGxlKTtcbiAgICAgIGV4cGVjdChcbiAgICAgICAgb2xkVGl0bGVzW2luZGV4XS5kdXJhdGlvbiA9PT0gXCIxbXNcIiB8fFxuICAgICAgICAgIG9sZFRpdGxlc1tpbmRleF0uZHVyYXRpb24gPT09IFwiMG1zXCJcbiAgICAgICkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlc2NyaWJlKFwiaGFuZGxpbmcgb2YgcHJvdmlkZXJzXCIsIGZ1bmN0aW9uKCkge1xuICAgIGl0KFwicmVnaXN0ZXJzIHByb3ZpZGVycyBwcm9wZXJseSBhbmQgY2xlYXJzIHRoZW0gb3V0IHdoZW4gdGhleSBkaWVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBwcm92aWRlciA9IHJlZ2lzdHJ5LmNyZWF0ZSgpO1xuICAgICAgZXhwZWN0KHJlZ2lzdHJ5LnByb3ZpZGVycy5oYXMocHJvdmlkZXIpKS50b0JlKHRydWUpO1xuICAgICAgcHJvdmlkZXIuZGlzcG9zZSgpO1xuICAgICAgZXhwZWN0KHJlZ2lzdHJ5LnByb3ZpZGVycy5oYXMocHJvdmlkZXIpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgICBpdChcImVtaXRzIHVwZGF0ZSBldmVudCBwcm9wZXJseVwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGNvbnN0IHByb3ZpZGVyID0gcmVnaXN0cnkuY3JlYXRlKCk7XG4gICAgICBjb25zdCB1cGRhdGUgPSBqYXNtaW5lLmNyZWF0ZVNweShcInVwZGF0ZVwiKTtcbiAgICAgIHJlZ2lzdHJ5Lm9uRGlkVXBkYXRlKHVwZGF0ZSk7XG4gICAgICBleHBlY3QodXBkYXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgcHJvdmlkZXIuYWRkKFwiSGV5XCIpO1xuICAgICAgcHJvdmlkZXIucmVtb3ZlKFwiSGV5XCIpO1xuICAgICAgcHJvdmlkZXIuY2xlYXIoKTtcbiAgICAgIGV4cGVjdCh1cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdCh1cGRhdGUuY2FsbHMubGVuZ3RoKS50b0JlKDIpO1xuICAgIH0pO1xuICAgIGl0KFwiYWRkcyBhbmQgcmV0dXJucyBzb3J0ZWQgdGl0bGVzXCIsIGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3QgcHJvdmlkZXIgPSByZWdpc3RyeS5jcmVhdGUoKTtcbiAgICAgIHByb3ZpZGVyLmFkZChcIkhleVwiKTtcbiAgICAgIGF3YWl0IHdhaXQoMSk7XG4gICAgICBwcm92aWRlci5hZGQoXCJXb3dcIik7XG4gICAgICBhd2FpdCB3YWl0KDEpO1xuICAgICAgcHJvdmlkZXIuYWRkKFwiSGVsbG9cIik7XG4gICAgICB2YWxpZGF0ZVRpbGVzKHJlZ2lzdHJ5LmdldFRpbGVzQWN0aXZlKCksIFtcIkhlbGxvXCIsIFwiV293XCIsIFwiSGV5XCJdKTtcbiAgICB9KTtcbiAgICBpdChcImFkZHMgcmVtb3ZlZCBvbmVzIHRvIGhpc3RvcnlcIiwgYXN5bmMgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBwcm92aWRlciA9IHJlZ2lzdHJ5LmNyZWF0ZSgpO1xuICAgICAgcHJvdmlkZXIuYWRkKFwiQm95XCIpO1xuICAgICAgYXdhaXQgd2FpdCgxKTtcbiAgICAgIHByb3ZpZGVyLmFkZChcIkhleVwiKTtcbiAgICAgIHZhbGlkYXRlVGlsZXMocmVnaXN0cnkuZ2V0VGlsZXNBY3RpdmUoKSwgW1wiSGV5XCIsIFwiQm95XCJdKTtcbiAgICAgIGV4cGVjdChyZWdpc3RyeS5nZXRUaWxlc09sZCgpKS50b0VxdWFsKFtdKTtcblxuICAgICAgcHJvdmlkZXIucmVtb3ZlKFwiSGV5XCIpO1xuICAgICAgdmFsaWRhdGVUaWxlcyhyZWdpc3RyeS5nZXRUaWxlc0FjdGl2ZSgpLCBbXCJCb3lcIl0pO1xuICAgICAgdmFsaWRhdGVPbGRUaWxlcyhyZWdpc3RyeS5nZXRUaWxlc09sZCgpLCBbXCJIZXlcIl0pO1xuICAgIH0pO1xuICAgIGl0KFwiYWRkcyBjbGVhcmVkIG9uZXMgdG8gaGlzdG9yeVwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGNvbnN0IHByb3ZpZGVyID0gcmVnaXN0cnkuY3JlYXRlKCk7XG4gICAgICBwcm92aWRlci5hZGQoXCJIZWxsb1wiKTtcbiAgICAgIHByb3ZpZGVyLmFkZChcIldvcmxkXCIpO1xuXG4gICAgICB2YWxpZGF0ZVRpbGVzKHJlZ2lzdHJ5LmdldFRpbGVzQWN0aXZlKCksIFtcIkhlbGxvXCIsIFwiV29ybGRcIl0pO1xuICAgICAgZXhwZWN0KHJlZ2lzdHJ5LmdldFRpbGVzT2xkKCkpLnRvRXF1YWwoW10pO1xuXG4gICAgICBwcm92aWRlci5jbGVhcigpO1xuICAgICAgdmFsaWRhdGVUaWxlcyhyZWdpc3RyeS5nZXRUaWxlc0FjdGl2ZSgpLCBbXSk7XG4gICAgICB2YWxpZGF0ZU9sZFRpbGVzKHJlZ2lzdHJ5LmdldFRpbGVzT2xkKCksIFtcIkhlbGxvXCIsIFwiV29ybGRcIl0pO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoXCJnZXRUaWxlc09sZFwiLCBmdW5jdGlvbigpIHtcbiAgICBpdChcImV4Y2x1ZGVzIGFjdGl2ZSBvbmVzIGZyb20gaGlzdG9yeVwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGNvbnN0IHByb3ZpZGVyID0gcmVnaXN0cnkuY3JlYXRlKCk7XG4gICAgICBwcm92aWRlci5hZGQoXCJZbyBDSlwiKTtcbiAgICAgIHByb3ZpZGVyLmFkZChcIk11cmljYVwiKTtcbiAgICAgIHByb3ZpZGVyLnJlbW92ZShcIllvIENKXCIpO1xuICAgICAgcHJvdmlkZXIucmVtb3ZlKFwiTXVyaWNhXCIpO1xuICAgICAgcHJvdmlkZXIuYWRkKFwiWW8gQ0pcIik7XG5cbiAgICAgIHZhbGlkYXRlT2xkVGlsZXMocmVnaXN0cnkuZ2V0VGlsZXNPbGQoKSwgW1wiTXVyaWNhXCJdKTtcbiAgICB9KTtcbiAgICBpdChcImV4Y2x1ZGVzIGR1cGxpY2F0ZXMgYW5kIG9ubHkgcmV0dXJucyB0aGUgbGFzdCBvbmVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBwcm92aWRlciA9IHJlZ2lzdHJ5LmNyZWF0ZSgpO1xuXG4gICAgICBwcm92aWRlci5hZGQoXCJTb21lXCIpO1xuICAgICAgcHJvdmlkZXIuYWRkKFwiVGhpbmdzXCIpO1xuICAgICAgcHJvdmlkZXIucmVtb3ZlKFwiU29tZVwiKTtcbiAgICAgIHByb3ZpZGVyLnJlbW92ZShcIlRoaW5nc1wiKTtcbiAgICAgIHByb3ZpZGVyLmFkZChcIlNvbWVcIik7XG4gICAgICBwcm92aWRlci5yZW1vdmUoXCJTb21lXCIpO1xuXG4gICAgICB2YWxpZGF0ZU9sZFRpbGVzKHJlZ2lzdHJ5LmdldFRpbGVzT2xkKCksIFtcIlRoaW5nc1wiLCBcIlNvbWVcIl0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19